<!DOCTYPE html>
<html>
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/topojson.v2.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<title>United States Mass shootings</title>
</head>
<style>
	html {
		scroll-behavior: smooth;
	}
	.states-borders{
		fill: none;
	  stroke: #000;
	  stroke-width: 0.5px;
	  stroke-linejoin: round;
	  stroke-linecap: round;
	  pointer-events: none;
	}
</style>

<body>
	<div id="section1" class="card text-center">
		<div class="card-header">
			<h2>Mass Shootings across cities in the U.S.</h2>
		</div>
		<div class="card-body">
			<svg id="graph_1" width="1000" height="600"></svg>
		</div>
	</div>
	</body>
</html>

<script>

	var map_svg = d3.select("#graph_1");
	var projection = d3.geoMercator();
	var path = d3.geoPath().projection(projection);

	d3.json("us.json", function(error, us) {
			if (error) throw error;

			states = topojson.feature(us, us.objects.states).features
			projection
			.scale(1000)
			.center([-98.57, 39.82])

			map_svg.selectAll("path")
					.data(states).enter()
					.append("path")
					.attr("class", "feature")
					.style("fill", "lightgray")
					.attr("d", path);

			map_svg.append("path")
      .attr("class", "states-borders")
      .attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));

			d3.csv("Stanford_MSA_cleaned.csv", function(error, data){
				if (error) throw error;
				map_svg.selectAll("circle")
                .data(data).enter()
                .append("circle")
                .attr("cx", function (d) {
                	return projection([parseFloat(d['Longitude']), parseFloat(d['Latitude'])])[0]; })
                .attr("cy", function (d) { return projection([parseFloat(d['Longitude']), parseFloat(d['Latitude'])])[1]; })
                .attr("r", function (d) { return  ((parseFloat(d['CaseID'])/40)).toString()+"px"})
                .attr("fill",'red')
                .style("stroke-width", 1.5)
                .append("title")
                .text(function(d) { return d['Total Number of Victims']+', '+d['Location']; });
			});
	});
</script>